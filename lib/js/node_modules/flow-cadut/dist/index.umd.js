!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@onflow/config"),require("fs"),require("path"),require("prettier"),require("prettier/parser-babel"),require("@onflow/types"),require("@onflow/fcl"),require("handlebars"),require("simple-git")):"function"==typeof define&&define.amd?define(["exports","@onflow/config","fs","path","prettier","prettier/parser-babel","@onflow/types","@onflow/fcl","handlebars","simple-git"],t):t((e||self).flowCadut={},e.config,e.fs,e.path,e.prettier,e.parserBabel,e.t,e.fcl,e.handlebars,e.simpleGit)}(this,function(e,t,r,n,o,s,c,a,i,l){function u(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}function p(e){if(e&&e.__esModule)return e;var t=Object.create(null);return e&&Object.keys(e).forEach(function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}}),t.default=e,t}var f=u(r),d=u(n),m=u(o),g=u(s),h=p(c),y=p(a),x=u(i),v=u(l);const b={emulator:{FlowToken:"0xee82856bf20e2aa6",FungibleToken:"0x0ae53cb6e3f42a79"},testnet:{FlowToken:"0x7e60df042a9c0868",FungibleToken:"0x9a0766d93b6608b7",LockedTokens:"0x95e019a17d0e23d7",StakingProxy:"0x7aad92e5a0715d21"},mainnet:{FlowToken:"0x1654653399040a61",FungibleToken:"0xf233dcee88fe0abe",LockedTokens:"0x8d0e87b65159ae63",StakingProxy:"0x62430cf28c26d095"}},w={mainnet:"https://access.mainnet.onflow.org",testnet:"https://access-testnet.onflow.org",emulator:"http://localhost:8080"},P=e=>{const[t]=e.split("");return t.toUpperCase()+e.slice(1)},$=e=>e.replace(/-/g,"_").split("_").map((e,t)=>t>0?P(e):e).join(""),T=(e,t,r)=>r?e.replace(t,"").split(r):e.replace(t,"").split(A(e)),A=e=>{switch(!0){case e.indexOf("//")>=0:return"//";case e.indexOf("/")>=0:return"/";case e.indexOf("\\")>=0:return"\\";default:return""}},S=e=>e.replace(/\s+/g," "),j=e=>f.default.readFileSync(e,"utf8"),F=(e,t)=>{const r=n.dirname(e);return f.default.mkdirSync(r,{recursive:!0}),f.default.writeFileSync(e,t,{encoding:"utf8"})},k=function(e){try{return Promise.resolve(f.default.promises.readdir(e,{withFileTypes:!0})).then(function(t){return Promise.resolve(Promise.all(t.map(t=>{const r=n.resolve(e,t.name);return t.isDirectory()?k(r):r}))).then(function(e){return e.flat()})})}catch(e){return Promise.reject(e)}},C=e=>e.replace(/\..*/,""),N=function(e,t){try{return Promise.resolve(f.default.promises.readdir(e,{withFileTypes:!0})).then(function(r){const o=r.reduce((t,r)=>{if(r.isDirectory())t.folders.push(r),t.folderNames.push(r.name);else{const o=$(r.name),s=C(o),c="/** pragma type contract **/";if(r.isFile()){const o=n.resolve(e,r.name);f.default.readFileSync(o,"utf8").includes(c)?t.contracts.push(s):t.files.push(s)}}return t},{folderNames:[],folders:[],files:[],contracts:[]});o.name=e;const s=t({folders:o.folderNames,files:o.files,contracts:o.contracts});return F(`${e}/index.js`,((e,t)=>{const r={printWidth:100,endOfLine:"lf",semi:!0,useTabs:!1,singleQuote:!1,trailingComma:"es5",tabWidth:2,...void 0};return m.default.format(e,{parser:"babel",plugins:[g.default],...r})})(s)),Promise.resolve(Promise.all(o.folders.map(r=>{const o=n.resolve(e,r.name);return r.isDirectory()?N(o,t):o}))).then(function(){return o})})}catch(e){return Promise.reject(e)}},O=e=>e.split(/\s/).map(e=>e.replace(/\s/g,"")).filter(e=>e.length>0&&"import"!==e&&"from"!==e),W=(e,t)=>{const[r,n]=t;return e[r]=n,e},E=e=>e&&0!==e.length?e.split("\n").filter(e=>e.includes("import")).map(O).reduce(W,{}):{},D=(e,t={})=>{const r=E(e),n=[];for(const e in r)!t[e]&&Object.prototype.hasOwnProperty.call(r,e)&&n.push(e);return n},I=(e=[],t="")=>{const r="Missing imports for contracts:";console.error(t?`${t} ${r}`:r,e)},q=/(\s*import\s*)([\w\d]+)(\s+from\s*)([\w\d".\\/]+)/g,L=(e,t,r=!0)=>e.replace(q,(e,n,o,s,c)=>{const a=r?o:c;return`${n}${o} from ${t instanceof Function?t(a):t[a]}`}),R="contract",U="transaction",_="script",M=(e,t)=>{const r=S(e.replace(/[\n\r]/g,""));if(r){const e=new RegExp(t,"g").exec(r);if(e)return""===e[1]?[]:e[1].split(",").map(e=>e.replace(/\s*/g,"")).filter(e=>""!==e)}return[]},B=e=>M(e,"(?:prepare\\s*\\(\\s*)([^\\)]*)(?:\\))"),z=e=>M(e,"(?:fun\\s+main\\s*\\(\\s*)([^\\)]*)(?:\\))"),G=e=>M(e,"(?:transaction\\s*\\(\\s*)([^\\)]*)(?:\\))"),H=e=>{const t=e.replace(/\r\n|\n|\r/g," "),r=/\w+\s+contract\s+(?:interface)*\s*(\w*)/g.exec(t);if(r.length<2)throw new Error("Contract Error: can't find name of the contract");return r[1]},Q=e=>{if(/transaction\s*(\(\s*\))*\s*/g.test(e)){const t=B(e),r=G(e);return{type:U,signers:t.length,args:r}}if(/pub\s+fun\s+main\s*/g.test(e)){const t=z(e);return{type:_,args:t}}if(/\w+\s+contract\s+(\w*\s*)\w*/g.test(e)){const t=H(e);return{type:R,signers:1,args:[],contractName:t}}return{type:"unknown"}},V=e=>!e||"string"!=typeof e,J=e=>{if(V(e))return!1;const t=e.replace(/\s/g,"");return t.startsWith("[")&&t.endsWith("]")},K=e=>{if(V(e))return!1;const t=e.replace(/\s/g,"");return t.startsWith("{")&&t.endsWith("}")},X=e=>J(e)||K(e),Y=e=>e.split(/(\w+)\s*:\s*([\w{}[\]:\s?]*)/).filter(e=>""!==e).map(e=>e.replace(/\s*/g,"")),Z=e=>Y(e)[1],ee=e=>/{(.*)}/.exec(e)[1].split(/([^:]*):(.*)/).map(e=>e.replace(/\s/g,"")).filter(e=>e),te=e=>/\[(.*)\]/.exec(e)[1].replace(/\s+/g,""),re=e=>!V(e)&&(e.includes("?")?h.Optional(h[(e=>e.slice(0,-1))(e)]):h[e]),ne=e=>{if(X(e))switch(!0){case J(e):{const t=te(e);let r=re(t);return J(t)&&(r=ne(t)),h.Array(r)}default:return re(e)}return re(e)},oe=(e,t)=>{const r=ne(e);switch(!0){case(e=>{if(V(e))return!1;let t=e.endsWith("?")?e.slice(0,-1):e;return(e=>!V(e)&&(e.startsWith("Int")||e.startsWith("UInt")||e.startsWith("Word")))(t)||(e=>"String"===e)(t)||(e=>"Character"===e)(t)||(e=>"Bool"===e)(t)})(e):return y.arg(t,r);case(e=>!V(e)&&(e.startsWith("Fix64")||e.startsWith("UFix64")))(e):return null===t?y.arg(null,r):(isNaN(parseFloat(t))&&(e=>{throw new Error("Type Error: Expected proper value for fixed type")})(),y.arg(parseFloat(t).toFixed(8),r));case(e=>"Address"===e||"Address?"===e)(e):{const e=null==(n=t)?null:"0x"+(e=>null==e?null:e.replace(/^0x/,""))(n);return y.arg(e,r)}case J(e):{const n=te(e);return X(n),y.arg(t,r)}case K(e):{const[r,n]=ee(e),o=[],s=Object.keys(t);for(let e=0;e<s.length;e++){const r=s[e];let c;c=X(n)?oe(n,t[r]):t[r],o.push({key:r,value:c})}const c=ne(r),a=ne(n);return y.arg(o,h.Dictionary({key:c,value:a}))}default:throw`${e} is not supported`}var n},se=(e=[],t)=>{if(t.length<e.length)throw new Error("Not enough arguments");return t.map((t,r)=>{const n=oe(e[r],t);var o;return(o=n).xform.asArgument(o.value),n})},ce=(e,t=[])=>{const r=Q(e).args.map(Z);return se(r,t)},ae=d.default.resolve(process.cwd(),"./temp-generator-repo"),ie=()=>{f.default.existsSync(ae)&&f.default.rmdirSync(ae,{recursive:!0})},le=function(e,t,r={}){try{const o=A(e),s=`${n.resolve(e)}${o}`;return Promise.resolve(k(e)).then(function(e){for(let n=0;n<e.length;n++){const o=e[n];if(!o.endsWith(".cdc"))return;const c=T(o,s),a=c.slice(0,-1),i=c.slice(-1)[0],l=r.dependency||"flow-cadut",u=j(o).replace(/`/g,"'"),p=$(i.replace(".cdc","")),f=Q(u);let d,m=0;switch(f.args&&(m=f.args.length),f.type){case _:return void(d=x.default.templates.script({code:u,name:p,ixDependency:l,argsAmount:m,assetName:p}));case U:{const e=B(u);return void(d=x.default.templates.transaction({code:u,name:p,ixDependency:l,argsAmount:m,signersAmount:e.length,assetName:p}))}case R:return void(d=x.default.templates.contract({code:u,name:p,ixDependency:l,contractName:f.contractName,assetName:p}));default:d="// Unsupported file"}const g=a.join("/");F(`${t}/${g}/${p}.js`,d)}return Promise.resolve(N(t,x.default.templates.package)).then(function(){})})}catch(e){return Promise.reject(e)}};function ue(e,t){try{var r=e()}catch(e){return t(e)}return r&&r.then?r.then(void 0,t):r}const pe=function(e,t){try{const{code:r,args:n,addressMap:o,limit:s}=e,c=L(r,o),a=s||100,i="script"===t?[y.script(c)]:[y.transaction(c)];if(n&&i.push(y.args(((e,t)=>{if(0===e.length)return[];const r=e[0];return Array.isArray(r)&&r[r.length-1].asArgument?(e=>e.reduce((e,t)=>[...e,...((e,t)=>{const r=e[e.length-1];return e.slice(0,-1).map(e=>((e,t)=>y.arg(e,t))(e,r))})(t)],[]))(e):ce(t,e)})(n,r))),i.push(y.limit(a)),"transaction"===t){const{proposer:t,payer:r,signers:n=[]}=e,o=0===n.length?[r]:n,s=t||r;i.push(y.payer(r)),i.push(y.proposer(s)),i.push(y.authorizations(o))}return Promise.resolve(y.send(i))}catch(e){return Promise.reject(e)}},fe=function(e){try{return Promise.resolve(ue(function(){return Promise.resolve(pe(e,"script")).then(function(e){return Promise.resolve(y.decode(e)).then(function(e){return[e,null]})})},function(e){return[null,e.message]}))}catch(e){return Promise.reject(e)}},de=function(e,t=!0){try{return Promise.resolve(ue(function(){return Promise.resolve(pe(e,"transaction")).then(function(e){let r;function n(t){return r?t:[e,null]}const o=function(){if(t)return Promise.resolve(y.tx(e).onceSealed()).then(function(e){return r=1,[e,null]})}();return o&&o.then?o.then(n):n(o)})},function(e){return[null,e.message]}))}catch(e){return Promise.reject(e)}},me=function(e){try{const{name:t,to:r,payer:n,proposer:o,update:s=!1,code:c}=e,a=s?"\n    transaction(name: String, code: String) {\n      prepare(acct: AuthAccount){\n        let decoded = code.decodeHex()\n        \n        acct.contracts.add(\n          name: name,\n          code: decoded,\n        )\n      }\n    }\n  ":"\n  transaction(name: String, code: String){\n    prepare(acct: AuthAccount){\n      let decoded = code.decodeHex()\n      \n      if acct.contracts.get(name: name) == nil {\n        acct.contracts.add(name: name, code: decoded)\n      } else {\n        acct.contracts.update__experimental(name: name, code: decoded)\n      }\n    }\n  }\n",i=Buffer.from(c,"utf8").toString("hex");let l=r,u=r;return n&&(u=n,l=o||n),de({payer:u,proposer:l,signers:[r],code:a,args:[t,i]})}catch(e){return Promise.reject(e)}};e.CONTRACT=R,e.SCRIPT=_,e.TRANSACTION=U,e.argType=Z,e.capitalizeFirstLetter=P,e.clearPath=e=>{f.default.rmdirSync(e,{recursive:!0})},e.collapseSpaces=S,e.deployContract=me,e.executeScript=fe,e.extract=M,e.extractContractName=H,e.extractImports=E,e.extractScriptArguments=z,e.extractSigners=B,e.extractTransactionArguments=G,e.generateExports=N,e.getArrayType=te,e.getDictionaryTypes=ee,e.getEnvironment=function(){try{return Promise.resolve(t.config().get("ix.env")).then(function(e){return b[e]||b.emulator})}catch(e){return Promise.reject(e)}},e.getFilesList=k,e.getSplitCharacter=A,e.getTemplateInfo=Q,e.mapArgument=oe,e.mapArguments=se,e.mapValuesToCode=ce,e.missingImports=D,e.mutate=de,e.processFolder=le,e.processGitRepo=function(e,t,r,n={}){try{const r=v.default({baseDir:process.cwd(),binary:"git"}),o=(e=>{const t=/(\w+:\/\/)(.+@)*([\w\d\.]+)(:[\d]+)?\/*(.*)/g.exec(e)[5].split("/"),[r,n]=t;return`https://github.com/${r}/${n}`})(e);console.log("Preparing space"),ie();const s=[];return console.log(`Cloning ${o} repository to local machine`),Promise.resolve(r.clone(o,ae,s)).then(function(){const r=v.default({baseDir:ae,binary:"git"});return console.log("Extracting branch name and folder path from url"),Promise.resolve(r.branch(["--list","--all"])).then(function(o){return Promise.resolve(r.getRemotes()).then(function(s){const c=((e,t)=>{const r=t.map(e=>e.name);return e.map(e=>{for(let t=0;t<r.length;t++){const n=`remotes/${r[t]}/`;if(e.startsWith(n))return e.slice(n.length)}return e})})(o.all,s),a=((e,t)=>{for(let r=0;r<t.length;r++){const n=t[r],o=`tree/${n}/`,s=e.indexOf(o);if(s>=0)return{branch:n,fetchUrl:e.slice(0,s-1),folderPath:`./${e.slice(s+o.length)}`}}return{fetchUrl:e,folderPath:"./"}})(e,c);return a.branch&&(console.log(`Branch name: ${a.branch}`),console.log(`Check out ${a.branch} branch`),r.checkout(a.branch)),console.log("Processing Cadence template files"),Promise.resolve(le(`${ae}/${a.folderPath}`,t,n)).then(function(){console.log("Cleaning up"),ie(),console.log("Done!")})})})})}catch(e){return Promise.reject(e)}},e.query=fe,e.readFile=j,e.replaceImportAddresses=L,e.report=I,e.reportArguments=(e,t,r="")=>{if(t>e){const n=`Incorrect number of arguments: found ${e} of ${t}`;console.error(r?`${r} ${n}`:n)}},e.reportMissing=(e="items",t,r,n="")=>{if(r>t){const o=`Incorrect number of ${e}: found ${t} of ${r}`;console.error(n?`${n} ${o}`:o)}},e.reportMissingImports=(e,t,r="")=>{const n=D(e,t);n.length>0&&I(n,r)},e.sansExtension=C,e.sendTransaction=de,e.setEnvironment=function(e="emulator",r={}){try{const n=e.toLowerCase();if(!b[n])throw new Error(`Provided value "${n}" is not supported. Try "emulator", "testnet" or "mainnet". Default: "emulator"`);const{port:o,endpoint:s}=r,c="emulator"===n&&o?`http://localhost:${o}`:w[n],a=s||c;return Promise.resolve(t.config().put("ix.env",n)).then(function(){return Promise.resolve(t.config().put("accessNode.api",a)).then(function(){})})}catch(e){return Promise.reject(e)}},e.splitArgs=Y,e.trimAndSplit=T,e.underscoreToCamelCase=$,e.updateContract=function(e){try{return me({...e,update:!0})}catch(e){return Promise.reject(e)}},e.writeFile=F});
//# sourceMappingURL=index.umd.js.map
